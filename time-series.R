# Time Series Homework - US National Parks
# Sam Tenney

# Look time series for the Washington Monument, Jefferson Memorial, Wright Bros Memorial, 
# Acadia to find features that violate the ARIMA model assumptions.  State why they are
# unusual

# Read in the data for all 4 monuments

# Washington Monument Data
wash_mon <- read.csv(header = TRUE, stringsAsFactors = FALSE, text = '
Year,RecreationVisitors,TotalRecreationVisitors
1936,"857,441","81,365,896"
1937,"998,686","81,365,896"
1938,"832,439","81,365,896"
1939,"927,543","81,365,896"
1940,"959,624","81,365,896"
1941,"965,689","81,365,896"
1942,"499,734","81,365,896"
1943,"472,004","81,365,896"
1944,"550,991","81,365,896"
1945,"608,667","81,365,896"
1946,"846,249","81,365,896"
1947,"794,813","81,365,896"
1948,"805,231","81,365,896"
1949,"867,327","81,365,896"
1950,"906,661","81,365,896"
1951,"962,000","81,365,896"
1952,"985,391","81,365,896"
1953,"1,022,269","81,365,896"
1954,"1,010,400","81,365,896"
1955,"1,039,900","81,365,896"
1956,"1,013,400","81,365,896"
1957,"1,143,100","81,365,896"
1958,"1,031,500","81,365,896"
1959,"1,186,000","81,365,896"
1960,"1,392,900","81,365,896"
1961,"1,592,300","81,365,896"
1962,"1,758,300","81,365,896"
1963,"1,750,200","81,365,896"
1964,"1,893,600","81,365,896"
1965,"1,986,100","81,365,896"
1966,"2,059,300","81,365,896"
1967,"1,905,200","81,365,896"
1968,"1,607,800","81,365,896"
1969,"1,658,500","81,365,896"
1970,"1,541,600","81,365,896"
1971,"1,518,500","81,365,896"
1972,"1,613,482","81,365,896"
1973,"1,446,500","81,365,896"
1974,"1,436,200","81,365,896"
1975,"1,064,500","81,365,896"
1976,"1,385,100","81,365,896"
1977,"1,230,900","81,365,896"
1978,"1,451,336","81,365,896"
1979,"1,304,790","81,365,896"
1980,"1,305,760","81,365,896"
1981,"1,359,061","81,365,896"
1982,"1,292,284","81,365,896"
1983,"1,212,736","81,365,896"
1984,"1,342,093","81,365,896"
1985,"1,229,062","81,365,896"
1986,"1,271,214","81,365,896"
1987,"1,300,983","81,365,896"
1988,"1,218,031","81,365,896"
1989,"1,136,662","81,365,896"
1990,"1,245,479","81,365,896"
1991,"1,168,736","81,365,896"
1992,"1,165,160","81,365,896"
1993,"1,080,030","81,365,896"
1994,"1,000,278","81,365,896"
1995,"943,098","81,365,896"
1996,"707,498","81,365,896"
1997,"841,218","81,365,896"
1998,"340,190","81,365,896"
1999,"553,420","81,365,896"
2000,"185,085","81,365,896"
2001,0,"81,365,896"
2002,"454,768","81,365,896"
2003,"529,985","81,365,896"
2004,"378,416","81,365,896"
2005,"467,550","81,365,896"
2006,"586,603","81,365,896"
2007,"591,081","81,365,896"
2008,"671,031","81,365,896"
2009,"676,002","81,365,896"
2010,"628,665","81,365,896"
2011,"430,153","81,365,896"
2012,0,"81,365,896"
2013,0,"81,365,896"
2014,"423,170","81,365,896"
2015,"493,550","81,365,896"
2016,"252,677","81,365,896"
2017,0,"81,365,896"
')

# Jefferson Memorial Data
jeff <- read.csv(header = TRUE, stringsAsFactors = FALSE, text = '
Year,RecreationVisitors,TotalRecreationVisitors
1941,0,"111,026,684"
1942,"6,374","111,026,684"
1943,"528,527","111,026,684"
1944,"380,117","111,026,684"
1945,"443,595","111,026,684"
1946,"682,023","111,026,684"
1947,"639,200","111,026,684"
1948,"537,978","111,026,684"
1949,"554,435","111,026,684"
1950,"664,369","111,026,684"
1951,"911,120","111,026,684"
1952,"900,791","111,026,684"
1953,"812,070","111,026,684"
1954,"803,500","111,026,684"
1955,"754,500","111,026,684"
1956,"734,700","111,026,684"
1957,"834,800","111,026,684"
1958,"800,400","111,026,684"
1959,"782,000","111,026,684"
1960,"926,900","111,026,684"
1961,"811,500","111,026,684"
1962,"1,251,300","111,026,684"
1963,"1,423,200","111,026,684"
1964,"1,661,300","111,026,684"
1965,"1,699,400","111,026,684"
1966,"1,278,900","111,026,684"
1967,"1,375,000","111,026,684"
1968,"1,088,800","111,026,684"
1969,"1,261,100","111,026,684"
1970,"146,600","111,026,684"
1971,"1,279,800","111,026,684"
1972,"1,314,202","111,026,684"
1973,"1,319,400","111,026,684"
1974,"1,404,800","111,026,684"
1975,"1,632,700","111,026,684"
1976,"1,829,400","111,026,684"
1977,"1,696,200","111,026,684"
1978,"2,263,493","111,026,684"
1979,"2,328,095","111,026,684"
1980,"1,216,966","111,026,684"
1981,"1,788,267","111,026,684"
1982,"1,270,798","111,026,684"
1983,"1,485,531","111,026,684"
1984,"1,873,728","111,026,684"
1985,"2,261,477","111,026,684"
1986,"3,273,574","111,026,684"
1987,"1,818,622","111,026,684"
1988,"1,329,531","111,026,684"
1989,"923,811","111,026,684"
1990,"794,102","111,026,684"
1991,"655,444","111,026,684"
1992,"939,852","111,026,684"
1993,"714,095","111,026,684"
1994,"531,436","111,026,684"
1995,"588,051","111,026,684"
1996,"748,862","111,026,684"
1997,"953,408","111,026,684"
1998,"2,139,549","111,026,684"
1999,"2,218,837","111,026,684"
2000,"1,976,325","111,026,684"
2001,"2,225,756","111,026,684"
2002,"2,066,932","111,026,684"
2003,"1,642,293","111,026,684"
2004,"2,200,371","111,026,684"
2005,"2,312,726","111,026,684"
2006,"2,219,255","111,026,684"
2007,"2,327,254","111,026,684"
2008,"2,363,263","111,026,684"
2009,"2,337,868","111,026,684"
2010,"2,305,856","111,026,684"
2011,"1,945,696","111,026,684"
2012,"2,613,131","111,026,684"
2013,"2,609,463","111,026,684"
2014,"2,708,607","111,026,684"
2015,"3,102,442","111,026,684"
2016,"3,414,345","111,026,684"
2017,"3,366,571","111,026,684"
')

# Wright Bros Memorial Data
wright <- read.csv(header = TRUE, stringsAsFactors = FALSE, text = '
Year,RecreationVisitors,TotalRecreationVisitors
1934,"17,010","27,523,814"
1935,"28,472","27,523,814"
1936,"48,690","27,523,814"
1937,"82,188","27,523,814"
1938,"80,911","27,523,814"
1939,"70,071","27,523,814"
1940,"54,729","27,523,814"
1941,"86,025","27,523,814"
1942,"11,319","27,523,814"
1943,"11,054","27,523,814"
1944,"8,592","27,523,814"
1945,"15,439","27,523,814"
1946,"49,512","27,523,814"
1947,"77,739","27,523,814"
1948,"72,984","27,523,814"
1949,"86,327","27,523,814"
1950,"111,116","27,523,814"
1951,"113,324","27,523,814"
1952,"153,072","27,523,814"
1953,"184,328","27,523,814"
1954,"184,500","27,523,814"
1955,"184,600","27,523,814"
1956,"305,500","27,523,814"
1957,"327,900","27,523,814"
1958,"241,100","27,523,814"
1959,"197,900","27,523,814"
1960,"237,600","27,523,814"
1961,"257,100","27,523,814"
1962,"223,600","27,523,814"
1963,"249,700","27,523,814"
1964,"296,800","27,523,814"
1965,"302,700","27,523,814"
1966,"370,900","27,523,814"
1967,"340,000","27,523,814"
1968,"310,400","27,523,814"
1969,"324,900","27,523,814"
1970,"489,400","27,523,814"
1971,"392,300","27,523,814"
1972,"423,725","27,523,814"
1973,"413,600","27,523,814"
1974,"472,700","27,523,814"
1975,"485,200","27,523,814"
1976,"505,000","27,523,814"
1977,"535,000","27,523,814"
1978,"481,140","27,523,814"
1979,"396,322","27,523,814"
1980,"428,809","27,523,814"
1981,"429,618","27,523,814"
1982,"415,360","27,523,814"
1983,"484,289","27,523,814"
1984,"409,493","27,523,814"
1985,"448,677","27,523,814"
1986,"630,779","27,523,814"
1987,"315,957","27,523,814"
1988,"328,617","27,523,814"
1989,"472,894","27,523,814"
1990,"463,461","27,523,814"
1991,"461,494","27,523,814"
1992,"477,643","27,523,814"
1993,"477,362","27,523,814"
1994,"475,755","27,523,814"
1995,"434,671","27,523,814"
1996,"393,721","27,523,814"
1997,"425,132","27,523,814"
1998,"419,210","27,523,814"
1999,"375,681","27,523,814"
2000,"429,472","27,523,814"
2001,"438,548","27,523,814"
2002,"440,737","27,523,814"
2003,"712,181","27,523,814"
2004,"421,341","27,523,814"
2005,"458,948","27,523,814"
2006,"466,144","27,523,814"
2007,"494,331","27,523,814"
2008,"527,721","27,523,814"
2009,"476,291","27,523,814"
2010,"476,200","27,523,814"
2011,"445,455","27,523,814"
2012,"466,816","27,523,814"
2013,"447,796","27,523,814"
2014,"430,517","27,523,814"
2015,"437,184","27,523,814"
2016,"458,776","27,523,814"
2017,"414,244","27,523,814"
')

# Acadia Data
acadia <- read.csv(header = TRUE, stringsAsFactors = FALSE, text = '
Year,RecreationVisitors,TotalRecreationVisitors
1919,"64,000","167,021,463"
1920,"66,500","167,021,463"
1921,"69,836","167,021,463"
1922,"73,779","167,021,463"
1923,"64,200","167,021,463"
1924,"71,758","167,021,463"
1925,"73,673","167,021,463"
1926,"101,256","167,021,463"
1927,"123,699","167,021,463"
1928,"134,897","167,021,463"
1929,"149,554","167,021,463"
1930,"154,734","167,021,463"
1931,"162,238","167,021,463"
1932,"237,596","167,021,463"
1933,"262,712","167,021,463"
1934,"275,956","167,021,463"
1935,"316,114","167,021,463"
1936,"340,393","167,021,463"
1937,"383,036","167,021,463"
1938,"394,319","167,021,463"
1939,"396,468","167,021,463"
1940,"382,084","167,021,463"
1941,"409,961","167,021,463"
1942,"36,544","167,021,463"
1943,"8,246","167,021,463"
1944,"12,916","167,021,463"
1945,"20,200","167,021,463"
1946,"382,390","167,021,463"
1947,"434,069","167,021,463"
1948,"420,846","167,021,463"
1949,"438,584","167,021,463"
1950,"485,220","167,021,463"
1951,"518,556","167,021,463"
1952,"549,075","167,021,463"
1953,"556,195","167,021,463"
1954,"553,800","167,021,463"
1955,"655,000","167,021,463"
1956,"735,500","167,021,463"
1957,"858,900","167,021,463"
1958,"816,500","167,021,463"
1959,"755,900","167,021,463"
1960,"1,638,200","167,021,463"
1961,"1,574,600","167,021,463"
1962,"1,601,500","167,021,463"
1963,"1,864,800","167,021,463"
1964,"2,011,600","167,021,463"
1965,"1,733,600","167,021,463"
1966,"2,158,400","167,021,463"
1967,"2,102,000","167,021,463"
1968,"2,303,300","167,021,463"
1969,"2,489,800","167,021,463"
1970,"2,776,300","167,021,463"
1971,"2,101,100","167,021,463"
1972,"2,285,881","167,021,463"
1973,"2,394,000","167,021,463"
1974,"2,335,800","167,021,463"
1975,"2,380,500","167,021,463"
1976,"2,353,300","167,021,463"
1977,"2,734,600","167,021,463"
1978,"2,684,933","167,021,463"
1979,"2,787,366","167,021,463"
1980,"2,779,666","167,021,463"
1981,"2,997,972","167,021,463"
1982,"3,572,114","167,021,463"
1983,"4,124,639","167,021,463"
1984,"3,734,763","167,021,463"
1985,"3,745,570","167,021,463"
1986,"3,929,054","167,021,463"
1987,"4,288,154","167,021,463"
1988,"4,502,283","167,021,463"
1989,"5,440,952","167,021,463"
1990,"2,339,591","167,021,463"
1991,"2,475,857","167,021,463"
1992,"2,382,113","167,021,463"
1993,"2,656,034","167,021,463"
1994,"2,710,749","167,021,463"
1995,"2,845,378","167,021,463"
1996,"2,704,831","167,021,463"
1997,"2,760,306","167,021,463"
1998,"2,594,497","167,021,463"
1999,"2,602,227","167,021,463"
2000,"2,469,238","167,021,463"
2001,"2,516,551","167,021,463"
2002,"2,558,572","167,021,463"
2003,"2,431,062","167,021,463"
2004,"2,207,847","167,021,463"
2005,"2,051,484","167,021,463"
2006,"2,083,588","167,021,463"
2007,"2,202,228","167,021,463"
2008,"2,075,857","167,021,463"
2009,"2,227,698","167,021,463"
2010,"2,504,208","167,021,463"
2011,"2,374,645","167,021,463"
2012,"2,431,052","167,021,463"
2013,"2,254,922","167,021,463"
2014,"2,563,129","167,021,463"
2015,"2,811,184","167,021,463"
2016,"3,303,393","167,021,463"
2017,"3,509,271","167,021,463"
')


# Now find the data for Annual Visitors to Bryce Canyon and convert to millions
bryce <- read.csv(header = TRUE, stringsAsFactors = FALSE, text = '
Year,RecreationVisitors,TotalRecreationVisitors
1929,"21,997","52,282,073"
1930,"35,982","52,282,073"
1931,"41,572","52,282,073"
1932,"34,143","52,282,073"
1933,"32,878","52,282,073"
1934,"51,188","52,282,073"
1935,"63,703","52,282,073"
1936,"88,848","52,282,073"
1937,"94,331","52,282,073"
1938,"101,851","52,282,073"
1939,"101,500","52,282,073"
1940,"103,362","52,282,073"
1941,"124,563","52,282,073"
1942,"30,019","52,282,073"
1943,"7,690","52,282,073"
1944,"10,311","52,282,073"
1945,"33,463","52,282,073"
1946,"125,828","52,282,073"
1947,"163,172","52,282,073"
1948,"175,975","52,282,073"
1949,"192,552","52,282,073"
1950,"212,976","52,282,073"
1951,"224,801","52,282,073"
1952,"225,113","52,282,073"
1953,"242,820","52,282,073"
1954,"238,200","52,282,073"
1955,"254,200","52,282,073"
1956,"257,600","52,282,073"
1957,"263,000","52,282,073"
1958,"248,500","52,282,073"
1959,"278,300","52,282,073"
1960,"272,000","52,282,073"
1961,"264,800","52,282,073"
1962,"251,000","52,282,073"
1963,"289,500","52,282,073"
1964,"300,300","52,282,073"
1965,"366,800","52,282,073"
1966,"396,600","52,282,073"
1967,"295,000","52,282,073"
1968,"320,800","52,282,073"
1969,"366,900","52,282,073"
1970,"345,900","52,282,073"
1971,"377,800","52,282,073"
1972,"424,830","52,282,073"
1973,"429,700","52,282,073"
1974,"408,800","52,282,073"
1975,"579,200","52,282,073"
1976,"625,600","52,282,073"
1977,"611,500","52,282,073"
1978,"679,260","52,282,073"
1979,"558,095","52,282,073"
1980,"571,541","52,282,073"
1981,"474,092","52,282,073"
1982,"471,517","52,282,073"
1983,"472,633","52,282,073"
1984,"495,104","52,282,073"
1985,"500,782","52,282,073"
1986,"578,018","52,282,073"
1987,"718,342","52,282,073"
1988,"791,348","52,282,073"
1989,"808,045","52,282,073"
1990,"862,659","52,282,073"
1991,"929,067","52,282,073"
1992,"1,018,174","52,282,073"
1993,"1,107,951","52,282,073"
1994,"1,028,134","52,282,073"
1995,"994,548","52,282,073"
1996,"1,269,600","52,282,073"
1997,"1,174,824","52,282,073"
1998,"1,166,331","52,282,073"
1999,"1,081,521","52,282,073"
2000,"1,099,275","52,282,073"
2001,"1,068,619","52,282,073"
2002,"886,436","52,282,073"
2003,"903,760","52,282,073"
2004,"987,253","52,282,073"
2005,"1,017,681","52,282,073"
2006,"890,676","52,282,073"
2007,"1,012,563","52,282,073"
2008,"1,043,321","52,282,073"
2009,"1,216,377","52,282,073"
2010,"1,285,492","52,282,073"
2011,"1,296,000","52,282,073"
2012,"1,385,352","52,282,073"
2013,"1,311,875","52,282,073"
2014,"1,435,741","52,282,073"
2015,"1,745,804","52,282,073"
2016,"2,365,110","52,282,073"
2017,"2,571,684","52,282,073"
')

# Remove the commas and convert to numeric values
wash_mon$RecreationVisitors <- as.numeric(gsub(",", "", wash_mon$RecreationVisitors))
jeff$RecreationVisitors <- as.numeric(gsub(",", "", jeff$RecreationVisitors))
wright$RecreationVisitors <- as.numeric(gsub(",", "", wright$RecreationVisitors))
acadia$RecreationVisitors <- as.numeric(gsub(",", "", acadia$RecreationVisitors))

# Convert each park data to millions of visitors
wash_mon$RecreationVisitors <- wash_mon$RecreationVisitors/10^6
jeff$RecreationVisitors <- jeff$RecreationVisitors/10^6
wright$RecreationVisitors <- wright$RecreationVisitors/10^6
acadia$RecreationVisitors <- acadia$RecreationVisitors/10^6

# Plot the time series for each park

# Washington Monument Time Series
plot(RecreationVisitors~Year, data=wash_mon, type="b", 
     ylab="Annual Visitors (in millions)",
     main = "Washington Monument Annual Visitors")

# Violates the requirement of a constant mean change.  Each decade
# is different as the number of annual visitors fluctuates up and down,
# making it difficult to predict the future based off of the past.

# The different dips in numbers of visitors is a result of either wars or 
# restorations that needed to take place, such as upgrading the elevator
# in 2011, there was a major earthquake that caused significant damage
# that resulted in many renovations to the monument.

# Thomas Jefferson Memorial Time Series
plot(RecreationVisitors~Year, data=jeff, type="b", 
     ylab="Annual Visitors (in millions)",
     main = "Thomas Jefferson Memorial Annual Visitors")

# This time series violates the constant mean change as it has 
# many dips and rises of the number of visitors.  There is no steady
# increase or decrease that makes it nice to predict future values

# In the late 60s and into 1970, there was a persistant problem with
# the surrounding roads and sidewalks.  This lead to much reconstruction
# and rennovation, and some closure of the monument.  In the 90s, 
# offices, restrooms, and gift shop were added to the memorial, with the
# consequent construction deterring many visitors

# Wright Brothers Memorial Time Series
plot(RecreationVisitors~Year, data=wright, type="b", 
     ylab="Annual Visitors (in millions)",
     main = "Wright Brothers Memorial Annual Visitors")

# This time series has problems with the constant mean change as there
# are some random spikes in the number of visitors.  The graph looks to be curving
# and flattening out in the recent past after steadily increasing in its
# first years.

# The large increase in 2003 was due to the 100 anniversary of the Wright Brothers'
# first flight.  One reason the graph seems inconsistent is because there
# aren't that many visitors when scaled in millions.  The park never has gotten
# over a million visitors in a year, and in the last 40 years, the amount of visitors
# has stayed somewhere betweeen 400,000 to 500,000 with one or two years as exceptions.

# Acadia Time Series
plot(RecreationVisitors~Year, data=acadia, type="b", 
     ylab="Annual Visitors (in millions)",
     main = "Acadia Annual Visitors")

# Acadia doesn't have a constant mean change, especially in the last 30 years.
# It's hard to tell if the visitors will trend up or down since some decades it
# appears to be increasing, while others it is decreasing.

# The number of visitors seemed to be increasing steadily until the mid 1980s
# because the National Parks Services began counting visitors differently that 
# resulted in the number of visitors counted decreasing drastically from the old 
# way of counting visitors.

# Omit commas and change RecreationVisitors to a numeric and convert to millions
bryce$RecreationVisitors <- as.numeric(gsub(',', '', bryce$RecreationVisitors))
bryce$RecreationVisitors <- bryce$RecreationVisitors / 10^6

# Plot the time series for Bryce Canyon  
plot(RecreationVisitors~Year, data = bryce, type = "b",
     ylab = "Annual Visitors (in millions)",
     main = "Bryce Canyon National Park Annual Visitors")

# Data seems multiplicative (curvature), so we will need to transform it to 
# make it additive.  

# Transform the data
bryce$lnVisitors <- log(bryce$RecreationVisitors)
plot(lnVisitors~Year, data = bryce, type = "b",
     ylab = "ln - Annual Visitors (in millions)",
     main = "Bryce Canyon National Park Annual Visitors")

# After transforming the data, we can see there is a dip in the early 1940s
# during World War II, which we will need to filter out to achieve a constant mean.  We will make a subset
# beginning at 1950.

bryce1950 <- subset(bryce, Year > 1949)
plot(lnVisitors~Year, data = bryce1950, type = "b",
     ylab = "ln - Annual Visitors (in millions)",
     main = "Bryce Canyon National Park Annual Visitors")

# Fit an ARIMA(1,1,1) model
library(astsa)
bryce1950_out <- sarima(bryce$lnVisitors, 1,1,1)
bryce1950_out$ttable

# Forecast annual visitors (in millions) for the next 5 years.
bryce1950_future <- sarima.for(bryce1950$lnVisitors, n.ahead = 5, 1,1,1)

# Report table of predictions and 95% prediction intervals
bryce1950_future_L <- exp(bryce1950_future$pred - qnorm(0.975)*bryce1950_future$se)
bryce1950_future_U <- exp(bryce1950_future$pred + qnorm(0.975)*bryce1950_future$se)

# This gives the prediction table with lower and upper bounds for the next 5 years
bryceTable <- cbind(exp(bryce1950_future$pred), bryce1950_future_L, bryce1950_future_U)
colnames(bryceTable) <- c("Prediction Estimate", "Lower Bound", "Upper Bound")
bryceTable_ts <- ts(bryceTable, start = 2018, end = 2022)
bryceTable_ts

# Create publication quality graphic with 5 year predictions
plot(RecreationVisitors~Year, data=bryce, type="b",
     ylab="Annual Visitors (in millions)",
     main = "Bryce Canyon National Park Annual Visitors",
     xlim=c(1990,2022), ylim=c(1,6.7))

lines(2018:2022, exp(bryce1950_future$pred), col="darkorange2", type="b", pch=19)
lines(2018:2022, bryce1950_future_L, col="darkorange2", lty=2)
lines(2018:2022, bryce1950_future_U, col="darkorange2", lty=2)
