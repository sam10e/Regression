# genLinModelsTheoryHW

hay <- read.table(text = "
                  Yield,Handlines
                  4,3
                  1,2
                  8,5
                  3,3
                  3,1
                  5,4
                  6,5
                  3,2
                  2,1
                  3,4", header = TRUE, sep = ",")

hay.out1 <- lm(Yield ~ Handlines + I(Handlines^2), data = hay, x = TRUE)
head(hay.out1$x)
summary(hay.out1)

# Scatterplot
plot(Yield ~ Handlines, data = hay)
xstar <- seq(0,60, length = 100)
yhat1 <- predict(hay.out1, newdata = data.frame(Handlines = xstar))
lines(xstar, yhat1, col = "red", lwd = 3)

# Test Ho: no curvature effect - take out I(Handlines^2)
hay.reduced <- lm(Yield ~ Handlines, data = hay)
anova(hay.reduced, hay.out1)

# NFL Data
nfl <- read.table(text = '
Audience,TotalPoints
14.903,41.5
64.241,37
77.858,33
66.372,44
46.189,37.5
79.673,40.5
40.77,39.5
86.715,37
49.909,41.5
91.942,38
51.029,42
53.509,54.5
31.698,41.5
10.435,34
17.183,45.5
81.229,41
81.961,43.5
85.444,43
60.203,41
70.12,36.5
46.957,43.5
62.998,33.5
98.363,41
30.547,39
93.544,36.5
68.925,38.5
53.035,45.5
37.982,31.5
42.25,45
28.809,45.5
65.341,38.5
72.166,49.5
48.988,44
42.017,43.5
73.164,48
93.997,50
102.711,40
102.251,48.5
46.547,46.5
49.923,38.5
42.174,36.5
77.795,38.5
5.129,36.5
81.498,47.5
82.45,40
46.57,43.5
72.877,34
14.434,38
43.187,36
53.672,46
70.967,40
35.101,37
59.592,46
81.083,47.5
53.114,47.5
71.004,43.5
52.833,38.5
16.924,42.5
60.497,42
62.158,42.5
40.661,36.5
28.909,34
28.524,39.5
65.345,37.5
56.775,34
72.473,47.5
65.878,44.5
55.186,45.5
65.33,47
26.746,40
60.47,37
70.841,36.5
80.496,42
91.945,42.5
39.127,40
71.359,42
17.067,39.5
49.856,45
47.52,44.5
15.636,37.5
98.072,40
61.501,36.5
85.832,40.5
20.393,44
62.532,47
59.674,47.5
60.691,41.5
80.244,37
44.275,46
50.123,47
78.407,35
57.103,36
48.748,37.5
25.921,39.5
63.118,43.5
100.866,41
85.816,42.5
18.255,42.5
41.653,48
25.506,43.5
11.945,42.5
72.084,46.5
53.079,51
83.737,41.5
95.677,42
34.738,46.5
47.261,37.5
19.187,47.5
53.246,42
65.431,46.5
42.971,37.5
33.616,47.5
37.792,45.5
72.595,43.5
59.632,38
59.186,32
39.99,51.5
100.573,47.5
78.422,47
26.101,45
66.098,45
41.445,46
56.412,42
110.356,48
22.432,42
60.943,36
40.694,37.5
82.851,37.5
66.337,45
101.716,46
45.794,40.5
53.543,41
45.098,54.5
133.132,57
99.887,52.5
9.991,47
45.954,44
68.925,43
75.409,53.5
50.871,41.5
40.175,43.5
51.576,42
91.079,45
94.503,48
66.084,39.5
23.179,34.5
82.758,37
94.209,49
64.589,47.5
103.759,51.5
50.659,42
68.43,38
122.683,49
78.099,38
42.759,48.5
12.263,43.5
38.553,34.5
70.534,46.5
30.046,40.5
74.309,43
47.921,40
41.039,44.5
71.836,37.5
65.516,39
41.863,37.5
61.476,41
45.57,41.5
33.788,41
26.281,37
69.554,40.5
90.188,47
53.089,40
52.691,40.5
62.956,47
57.798,39
15.633,49
56.24,41.5
53.348,43.5
17.587,39
50.933,41.5
85.831,38
57.402,43
90.869,42
53.341,43
90.403,43
26,37
14.756,34.5
29.93,43
55.042,42
34.207,40
101.184,50.5
110.623,42
124.799,53.5
78.35,41
80.314,48.5
99.172,38.5
109.016,43
95.826,50.5
39.683,47
93.437,48
18.237,47
69.217,40.5
50.187,51.5
104.199,48
51.391,40.5
53.985,44.5
40.86,43
52.376,52
95.843,41
57.772,41
103.376,39
47.439,43.5
92.958,49.5
85.89,47
36.747,43.5
15.055,43.5
51.367,41
47.851,48.5
69.218,43
63.962,50
60.608,47
54.031,37.5
81.268,44.5
58.781,41
12.736,46
55.975,51.5
82.32,48.5
52.543,43
42.563,41
100.786,46.5
43.353,41
56.438,37
26.429,40.5
11.168,41
37.289,47
45.726,43.5
66.944,46.5
73.722,40.5
84.806,38
76.06,43.5
47.402,44.5
36.345,46
38.764,44.5
92.14,46
80.574,44.5
74.657,47.5
46.86,46.5
75.024,46
75.029,46.5
62.818,40
28.255,37.5
52.339,47
30.416,43.5
65.397,40.5
58.266,37
74.889,44
95.836,46.5
73.149,35
51.516,41
67.675,45
38.58,45
83.245,47
70.19,36
68.932,56
39.907,45.5
98.027,48
63.501,45.5
57.601,43
57.817,39.5
53.649,43
91.008,35.5
54.747,47.5
31.608,42.5
65.855,48.5
83.717,46.5
19.585,43
95.458,47
92.72,47
27.716,42.5
74.568,43.5
120.708,45.5
43.405,53.5
79.785,42
85.799,48
100.74,49.5
55.403,43.5
40.968,42.5
67.865,38
73.518,43.5
57.698,36.5
38.013,41
90.471,45
93.249,43.5
51.405,47.5
108.848,46.5
89.654,48.5
44.977,43
67.698,42
59.519,50.5
70.882,48
41.029,43
77.813,44.5
60.473,41.5
94.239,44.5
77.643,38
40.617,38.5
12.058,42
88.041,42.5
95.414,48.5
89.247,46.5
119.616,47.5
84.594,41.5
10.99,44.5
135.314,49
108.065,41.5
88.47,57.5
67.909,47
42.494,46
45.109,50
56.557,48
51.801,44
51.055,47.5
94.644,45
68.258,36.5
38.669,47
32.66,39.5
78.987,40.5
63.103,37
85.088,47.5
62.068,38
86.363,43
93.284,47
102.546,35
25.812,34
59.091,45.5
84.111,48.5
79.374,43
108.765,43.5
112.299,49
86.285,45
78.575,43.5
51.377,47
82.748,38.5
100.283,36
60.147,48
23.984,36
42.227,41.5
23.64,40.5
69.886,42.5
57.903,43
52.797,46.5
70.374,36
32.287,44
16.298,37.5
53.704,40.5
57.038,34.5
36.817,43.5
90.371,43.5
33.717,40
100.968,44.5
30.04,43.5
34.686,39.5
29.534,45
96.042,43.5
41.777,47.5
86.002,46
109.336,48
84.603,46
59.71,41.5
47.143,39.5
82.113,41.5
34.795,48
33.946,41.5
58.344,43.5
101.545,47
60.329,50
31.956,46
105.108,43.5
54.018,44.5
49.125,45
55.075,41.5
39.584,46
70.548,45.5
92.297,48
19.102,51
73.761,50.5
118.967,49.5
35.17,44
114.14,46.5
113.065,44.5
49.422,48
41.132,44.5
78.343,41
40.844,38
104.183,37.5
32.177,41
101.304,44
112.567,44.5
133.952,44
89.881,38
91.711,40.5
73.077,48.5
130.151,50.5
81.211,39.5
103.066,45
85.314,37
90.422,44
62.466,50
87.614,48.5
120.059,48
93.642,43.5
83.894,45
113.629,47.5
62.864,44.5
96.684,36
74.78,35.5
63.104,43
53.13,41
42.539,43
103.51,42.5
114.325,39.5
38.461,47
89.79,42
93.067,51
54.3,44
49.274,40.5
73.917,38.5
38.2,38
72.884,41
71.279,45
91.613,50.5
92.394,45.5
20.487,44.5
36.765,40
55.481,41.5
49.971,41
61.442,46.5
71.7,48
37.135,43.5
54.502,43.5
79.271,43.5
78.872,44
56.227,40.5
52.54,53
37.383,40.5
125.442,41.5
86.38,45
47.455,39
26.736,49
49.707,42.5
82.983,41
94.389,35.5
82.024,47.5
69.358,47.5
55.388,42.5
92.419,40.5
17.927,39
25.418,40
114.774,41
14.892,47
123.153,48
80.628,49
64.64,43.5
77.736,46.5
99.635,42
74.086,37.5
65.809,41.5
62.687,46.5
34.628,43.5
97.697,55.5
127.262,54
113.58,54
110.661,55
99.006,46
48.119,45
64.568,47
84.031,50.5
26.356,40.5
67.527,49
47.907,40.5
16.65,41.5
14.947,38
131.116,37.5
29.967,41.5
50.184,46.5
75.676,35.5
47.389,41.5
74.218,43
106.38,45.5
40.447,44
89.51,44
61.911,50
65.187,41.5
64.877,46.5
116.759,47.5
78.813,52
110.007,47
94.743,46.5
59.274,50
109.936,47.5
42.678,46
119.494,49.5
106.217,43
61.832,51
62.904,46.5
92.385,43
50.736,39
47.993,39
36.519,41
62.727,50
71.129,42.5
38.866,48
106.983,49.5
98.229,45
31.195,43.5
73.454,49.5
67.163,40
43.196,37
51.897,46.5
98.37,42
69.512,45
46.225,40
61.765,44.5
88.91,53.5
58.304,40.5
85.932,45
92.025,38
63.949,34.5
42.959,43.5
54.426,38
54.407,41
29.216,45.5
60.921,40
61.106,44.5
69.21,45
54.416,47
23.104,38
34.238,43
46.366,50
54.145,51
95.992,41
48.766,47
31.635,46.5
36.949,47.5
36.58,41.5
88.548,41
32.119,50.5
81.764,34.5
39.421,49.5
25.337,45
47.318,43
55.692,43.5
36.845,43.5
60.472,44
88.89,45.5
103.478,47.5
65.516,46
119.523,49
64.021,47.5
80.702,48
29.139,47
65.571,42
75.147,50.5
50.472,46.5
67.317,48
138.642,46
83.15,49.5
56.382,45.5
99.318,51
88.79,46
46.737,53.5
45.529,43.5
79.883,45.5
60.493,49
92.646,47
73.236,51
120.013,48.5
63.135,47
71.767,40.5
104.598,37.5
105.039,43.5
27.033,43
65.565,39.5
23.66,41
62.094,38.5
23.754,46
69.636,48
72.911,43
49.717,38.5
86.699,48
38.509,42.5
40.632,48
79.672,51
33.817,54.5
102.228,55.5
69.773,52.5
75.637,54
115.238,46.5
65.654,50.5
38.242,47
64.346,47.5
25.958,48.5
96.546,48
53.915,40.5
102.31,43
72.798,47
41.303,41.5
26.121,44.5
61.791,52.5
101.41,44.5
75.681,37
32.017,43
129.434,46
100.739,47
178.652,45.5
77.453,47.5
100.737,53.5
108.696,48
127.37,40.5
144.319,47.5
133.67,46.5
91.717,41
43.929,37.5
105.841,38
23.184,43
61.194,50
64.457,50
52.987,51.5
107.45,47.5
74.555,44.5', header = TRUE, sep = ",")

# 6th order polynomial
nfl.out <- lm(Audience ~ poly(TotalPoints,6),
           data = nfl, x = TRUE)

summary(nfl.out)

# piecewise linear curve with knot = 42.5
nfl.piece <- lm(Audience ~ TotalPoints + I( (TotalPoints >= 42.5)*(TotalPoints - 42.5)), 
                data = nfl)

summary(nfl.piece)

# Data plot
plot(Audience ~ TotalPoints, data = nfl)

# Estimated polynomial effect for 30 < TotalPoints < 60
plot(Audience ~ TotalPoints, data = nfl)
xstar <- seq(30,60, length = 100)
yhat2 <- predict(nfl.out, newdata = data.frame(TotalPoints = xstar))
lines(xstar, yhat2, col = "red", lwd = 3)

# Estimated piecewise linear effect for 30 < TotalPoints < 60
plot(Audience ~ TotalPoints, data = nfl)
xstar <- seq(30,60, length = 100)
yhat3 <- predict(nfl.piece, newdata = data.frame(TotalPoints = xstar))
lines(xstar, yhat3, col = "red", lwd = 3)