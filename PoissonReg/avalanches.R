# Sam Tenney
# Poisson Regression
# Avalanches.R

# Read in the data
library(XML)
library(RCurl)
avalanche.url <- "https://utahavalanchecenter.org/observations?page="
all.pages <- 0:202
avalanche <- NULL

for(page in all.pages) {
  this.url <- paste(avalanche.url, page, sep="")
  this.webpage <- htmlParse(getURL(this.url))
  
  thispage.avalanche <- readHTMLTable(this.webpage,which = 1, header = TRUE, stringsAsFactors = FALSE)
  
  avalanche <- rbind(avalanche, thispage.avalanche)
}

# Subset SLC region
avalanche.slc <- subset(avalanche,avalanche$Region == "Salt Lake")

# Convert Date column to dates with year-month format
avalanche.slc$Date <- as.Date(avalanche.slc$Date, "%m/%d/%Y")
avalanche.slc$Date <- format(avalanche.slc$Date, format = "%Y-%m")



# filter observations that just have avalanches
avalanche.slc2 <- subset(avalanche.slc, grepl("Avalanche", avalanche.slc[,3]))
colnames(avalanche.slc2) <- c("Date", "Region", "AvName", "Observer")

# Count how many observations each month
library(dplyr)
avalanche.slc3 <- avalanche.slc2 %>% 
  group_by(Date) %>% 
  summarise(Avalanches = n())


# Read in climate data from US NOAA for SLC weather 
climate <- read.table(text = '
"STATION","NAME","DATE","DT32","SNOW","TMIN"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-01","20","15.0","27.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-02","16","5.1","31.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-03","17","6.2","32.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-04","1","0.0","42.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-05","0","0.5","49.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-06","0","0.0","58.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-07","0","0.0","66.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-08","0","0.0","66.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-09","0","0.0","52.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-10","0","0.0","42.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-11","28","17.0","24.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2000-12","30","12.9","22.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-01","31","6.6","21.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-02","23","13.1","26.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-03","12","5.3","35.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-04","5","9.9","40.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-05","0","0.0","50.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-06","0","0.0","57.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-07","0","0.0","66.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-08","0","0.0","65.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-09","0","0.0","56.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-10","3","0.0","42.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-11","12","18.8","33.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2001-12","29","20.0","19.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-01","30","16.1","17.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-02","27","0.7","18.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-03","17","14.4","28.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-04","4","3.6","40.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-05","1","0.0","46.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-06","0","0.0","57.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-07","0","0.0","67.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-08","0","0.0","61.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-09","0","0.0","54.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-10","4","0.0","38.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-11","25","0.2","27.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2002-12","27","3.4","27.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-01","23","0.0","28.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-02","21","9.0","26.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-03","12","5.4","34.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-04","5","4.4","40.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-05","0","0.0","49.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-06","0","0.0","58.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-07","0","0.0","69.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-08","0","0.0","67.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-09","0","0.0","52.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-10","3","1.0","44.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-11","16","10.7","30.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2003-12","28","31.2","26.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-01","30","9.9","16.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-02","28","19.8","19.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-03","11","3.9","37.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-04","1","1.0","42.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-05","0","0.0","48.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-06","0","0.0","57.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-07","0","0.0","65.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-08","0","0.0","61.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-09","0","0.0","52.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-10","1","0.1","44.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-11","19","3.3","30.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2004-12","25","3.7","25.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-01","26","6.7","28.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-02","25","11.3","26.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-03","11","2.8","33.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-04","2","0.0","39.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-05","0","0.0","47.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-06","0","0.0","54.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-07","0","0.0","66.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-08","0","0.0","63.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-09","0","0.0","52.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-10","0","0.0","43.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-11","19","1.1","32.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2005-12","28","6.9","22.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-01","27","9.3","26.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-02","22","13.5","23.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-03","16","13.3","32.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-04","4","2.2","42.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-05","0","0.0","50.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-06","0","0.0","58.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-07","0","0.0","69.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-08","0","0.0","63.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-09","0","0.0","50.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-10","6","0.0","39.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-11","20","8.1","30.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2006-12","27","9.9","22.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-01","31","10.8","11.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-02","22","13.1","27.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-03","7","2.5","35.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-04","2","0.0","41.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-05","0","0.0","49.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-06","0","0.0","58.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-07","0","0.0","70.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-08","0","0.0","67.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-09","0","0.0","53.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-10","1","0.1","40.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-11","19","0.8","30.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2007-12","29","29.8","20.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-01","31","17.1","15.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-02","27","17.4","24.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-03","18","8.3","30.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-04","12","0.0","34.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-05","2","0.0","45.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-06","0","0.0","56.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-07","0","0.0","67.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-08","0","0.0","63.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-09","0","0.0","53.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-10","5","0.5","41.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-11","16","3.0","33.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2008-12","28","20.8","21.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-01","28","10.3","23.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-02","23","6.3","27.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-03","20","6.0","31.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-04","5","1.4","38.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-05","0","0.0","49.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-06","0","0.0","54.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-07","0","0.0","65.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-08","0","0.0","61.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-09","0","0.0","57.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-10","4","0.5","39.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-11","18","2.8","30.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2009-12","30","17.1","16.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-01","27","2.3","21.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-02","22","2.3","28.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-03","19","5.7","32.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-04","7","5.6","38.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-05","2","0.2","42.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-06","0","0.0","55.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-07","0","0.0","65.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-08","0","0.0","62.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-09","0","0.0","53.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-10","2","1.8","45.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-11","15","20.9","30.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2010-12","24","11.5","27.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-01","30","5.9","20.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-02","24","11.0","25.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-03","11","9.1","34.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-04","8","8.2","36.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-05","1","0.0","42.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-06","0","0.0","53.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-07","0","0.0","66.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-08","0","0.0","65.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-09","0","0.0","56.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-10","4","0.0","43.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-11","22","5.5","29.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2011-12","30","0.1","20.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-01","28","6.9","23.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-02","19","7.4","28.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-03","11","4.0","38.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-04","3","1.0","41.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-05","0","0.0","49.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-06","0","0.0","58.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-07","0","0.0","69.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-08","0","0.0","69.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-09","0","0.0","57.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-10","1","0.3","43.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-11","14","15.2","35.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2012-12","18","13.1","28.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-01","30","23.8","12.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-02","28","14.7","21.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-03","12","2.7","34.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-04","6","0.1","39.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-05","0","0.0","50.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-06","0","0.0","60.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-07","0","0.0","71.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-08","0","0.0","70.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-09","0","0.0","59.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-10","0","0.0","41.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-11","11","3.5","34.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2013-12","28","19.2","16.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-01","29","10.1","21.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-02","10","2.2","33.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-03","2","0.5","38.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-04","3","0.0","40.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-05","0","0.0","49.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-06","0","0.0","56.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-07","0","0.0","68.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-08","0","0.0","62.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-09","0","0.0","58.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-10","0","0.0","44.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-11","15","0.8","31.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2014-12","18","5.7","29.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-01","26","0.3","26.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-02","14","0.0","34.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-03","9","2.8","37.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-04","3","5.8","41.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-05","0","0.0","50.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-06","0","0.0","64.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-07","0","0.0","65.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-08","0","0.0","65.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-09","0","0.0","58.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-10","0","0.0","50.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-11","18","1.4","30.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2015-12","26","15.9","24.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-01","30","10.6","24.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-02","21","3.8","28.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-03","5","2.7","37.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-04","0","0.0","44.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-05","0","0.0","50.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-06","0","0.0","64.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-07","0","0.0","70.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-08","0","0.0","66.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-09","0","0.0","55.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-10","0","0.0","46.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-11","7","5.7","37.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2016-12","31","11.1","22.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-01","28","23.2","21.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-02","17","6.7","31.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-03","6","3.6","39.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-04","0","1.0","40.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-05","0","0.1","51.1"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-06","0","0.0","62.8"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-07","0","0.0","72.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-08","0","0.0","69.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-09","0","0.0","56.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-10","1","0.0","40.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-11","9","0.0","37.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2017-12","29","7.7","25.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-01","20","9.6","30.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-02","18","14.3","30.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-03","8","10.5","37.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-04","2","1.4","43.3"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-05","0","0.0","53.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-06","0","0.0","61.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-07","0","0.0","70.7"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-08","0","0.0","65.2"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-09","0","0.0","57.0"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-10","2","0.0","43.5"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-11","19","1.7","30.6"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2018-12","29","13.2","25.9"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2019-01","30","6.6","24.4"
"USW00024127","SALT LAKE CITY INTERNATIONAL AIRPORT, UT US","2019-02","20","13.9","27.8"
', header = TRUE, sep = ",")


# Merge the two datasets by month and year
slc <- merge(avalanche.slc3, climate, by.x = "Date", by.y = "DATE", all.y = TRUE)
slc$Avalanches[is.na(slc$Avalanches)] <- 0

# Remove STATION and NAME from dataset
slc2 <- slc[,c(-3,-4)]

# Filter for 'Snow Season'
jan <- subset(slc2, grepl("-01", slc$Date))
feb <- subset(slc2, grepl("-02", slc$Date))
mar <- subset(slc2, grepl("-03", slc$Date))
dec <- subset(slc2, grepl("-12", slc$Date))
slc <- rbind(jan, feb, mar, dec)

# Reorder dates to be chronilogical order by month
slc$Date <- format(slc$Date, format = "%m-%Y")
slc <- arrange(slc, Date)



# EDA
# Create a scatterplot of Avalanches and SNOW and notice discrete values of Avalanche
plot(Avalanches ~ SNOW, data = slc, main = "Avalanches to SNOW Levels")

# Create a scatterplot of Avalanches and DT32 and notice slightly increasing variance and slight curvature
plot(Avalanches ~ DT32, data = slc, main = "Avalanches to DT32 Levels")
plot(log(Avalanches) ~ DT32, data = slc, main = "log(Avalanches) to DT32 Levels")

# Analysis
# response variable: # of avalanches
# explanatory varaibles: 
#   SNOW = inches of snow
#   DT32 = days below 32
#   TMIN = low temperature for the month (degrees farenheit)

# Model
#   Avalanches ~ Poisson( exp( beta0 + beta1 SNOW + beta2 DT32 + beta3 TMIN ) )

slc.out <- glm(Avalanches ~ SNOW + DT32 + TMIN, data = slc, family = "poisson")

summary(slc.out)

# beta1 Snow = -0.02
# For each additional inch of snow, we estimate a decrease of 0.02 
# in log mean number of avalanches, holding all else constant

exp(coef(slc.out)[-1])
# For each additional inch of snowfall we estimate the mean 
# number of avalanches decreases by 2% (95% CI: -3.0%, -1.3%), holding all else constant

# 95% CI
exp( confint(slc.out)[-1,])
     
# For each additional day below 32 degrees, we estimate the mean number of
# avalanches to increases by 0.69% (95% CI: -0.8%, 2.2%), holding all else contant

# For each additional degree for the low temperature of the month,
# we estimate the mean number of avalanches to increase by 1.9% 
# (95% CI: 0.02%, 3.91%), holding all else constant

# Test Ho: beta1 SNOW = 0, Ha: beta1 SNOW != 0
# test statistic: -4.767; p-value < 0.001
# We reject Ho in favor of Ha: beta1 does not equal 0 at alpha = 0.05
# Grandma response: More snow means more avalanches

# Effect of temperature
slc.reduced <- glm(Avalanches ~ SNOW, data = slc, family = "poisson")
anova(slc.reduced, slc.out, test = "Chisq")

# Ho: beta2 = beta3 = 0
# Ha: at least one of beta2, beta3 not equal to zero
# test statistic: Chisq = 7.4062; p-value = 0.05
# Grandma response:
  # Careful going up to the ski resorts on the really cold days as 
  # the colder it is and the longer it's cold, the more likely there will be an avalanche

# Typical December
summary(dec)

predict(slc.out, newdata = data.frame(SNOW = 12.90, TMIN = 22.9, DT32 = 28),
        type = "response")
# 20 is the mean number of avalanches in December
logmu.hat <- predict(slc.out, newdata = data.frame(SNOW = 12.90, TMIN = 22.9, DT32 = 28),
        type = "link", se.fit = TRUE)
logmu.L <- logmu.hat$fit - 1.96 * logmu.hat$se.fit
logmu.U <- logmu.hat$fit + 1.96 * logmu.hat$se.fit

exp(logmu.L)
exp(logmu.U)

# Do typical January, February, March
summary(jan)
predict(slc.out, newdata = data.frame(SNOW = 9.75, TMIN = 22.45, DT32 = 28.50),
        type = "response")
# 21.43 is the mean number of avalanches in January

summary(feb)
predict(slc.out, newdata = data.frame(SNOW = 10.00, TMIN = 27.45, DT32 = 22.00),
        type = "response")
# 22.43 is the mean number of avalanches in February

summary(mar)
predict(slc.out, newdata = data.frame(SNOW = 5.30, TMIN = 34.80, DT32 = 11.00),
        type = "response")
# 26.46 is the mean number of avalanches in March
